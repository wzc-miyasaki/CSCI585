CREATE TABLE procedures (
    procedure_id INT NOT NULL,
    procedure_name VARCHAR(255) NOT NULL,
    PRIMARY KEY (procedure_id)
);

CREATE TABLE medicalRecord (
    record_id NUMBER NOT NULL,
    patientID NUMBER NOT NULL,
    procedure_type_id NUMBER NOT NULL,
    duration NUMBER NOT NULL,
    record_date DATE,
    CONSTRAINT record_pk PRIMARY KEY (record_id),
    CONSTRAINT fk_procedure_type_id FOREIGN KEY (procedure_type_id)
        REFERENCES procedures(procedure_id)
);

CREATE TABLE BillingRecord (
    billing_id NUMBER NOT NULL,
    med_id NUMBER NOT NULL,
    total_amount NUMBER NOT NULL,
    bill_date DATE,
    CONSTRAINT bill_pk PRIMARY KEY (billing_id),
    CONSTRAINT fk_medicalID FOREIGN KEY (med_id)
        REFERENCES medicalRecord(record_id)
);

-- Query
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('1', 'Dental Examinations');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('2', 'Teeth Cleaning');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('3', 'Fillings');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('4', 'Crowns');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('5', 'Teeth Whitening');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('6', 'Veneers');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('7', 'Braces');
INSERT INTO procedures (PROCEDURE_ID, PROCEDURE_NAME) VALUES ('8', 'Clear Aligners');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('1', '1', '1', '15', '17-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('2', '1', '2', '35', '17-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('3', '1', '4', '25', '17-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('4', '2', '1', '14', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('5', '3', '1', '14', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('6', '4', '1', '14', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('7', '5', '1', '17', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('8', '6', '1', '14', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('9', '7', '1', '12', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('10', '8', '1', '15', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('11', '2', '2', '31', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('12', '3', '5', '40', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('13', '3', '7', '15', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('14', '4', '2', '28', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('15', '5', '2', '31', '18-FEB-23');
INSERT INTO medicalRecord (RECORD_ID, PATIENTID, PROCEDURE_TYPE_ID, DURATION, RECORD_DATE) VALUES ('16', '6', '2', '34', '18-FEB-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('1', '1', '55', '17-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('2', '2', '75', '17-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('3', '3', '100', '17-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('4', '4', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('5', '5', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('6', '6', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('7', '7', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('8', '8', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('9', '9', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('10', '10', '55', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('11', '11', '82', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('12', '12', '180', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('13', '13', '200', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('14', '14', '75', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('15', '15', '100', '18-Feb-23');
INSERT INTO BillingRecord (BILLING_ID, MED_ID, TOTAL_AMOUNT, BILL_DATE) VALUES ('16', '16', '86', '18-Feb-23');



SELECT b.*, m.*, p.*
FROM BillingRecord b
INNER JOIN MedicalRecord m ON b.MED_ID = m.RECORD_ID
INNER JOIN procedures p ON m.procedure_type_id = p.procedure_id;


SELECT b.BILLING_ID, b.MED_ID, p.PROCEDURE_NAME, m.DURATION, b.TOTAL_AMOUNT AS cost, m.RECORD_DATE AS procedure_date, b.BILL_DATE
FROM BillingRecord b
INNER JOIN MedicalRecord m ON b.MED_ID = m.RECORD_ID
INNER JOIN procedures p ON m.procedure_type_id = p.procedure_id;


SELECT ROUND(AVG(b.total_amount), 3) AS average_income
FROM BillingRecord b
WHERE b.BILL_DATE BETWEEN TO_DATE('2023-02-18', 'YYYY-MM-DD') AND TO_DATE('2023-02-18', 'YYYY-MM-DD');